import{d as ee,h as te,m as ae,i as oe,f as le,k as ne,ag as s,aq as se,o as g,c as P,X as t,T as l,a as y,u as q,a8 as k,F as re,p as ie,S as V,W as m,U as I,Y as ue,e as de}from"./@vue-CRBWlwId.js";import{g as pe}from"./formatTime-Bwg9I4Gs.js";import{M as me}from"./@element-plus-tztFf6PP.js";import ce from"./editModule-DcXnG_b4.js";import{l as D,m as _e,z as fe,k as he,r as ge,_ as ye}from"./index-BfYElSN2.js";import{E as w,a as N}from"./element-plus-C9Ov05af.js";import"./pinia-BTdriGDs.js";import"./vue-router-B8aOcPyE.js";import"./vue-i18n-Bpsr_IBC.js";import"./@intlify-Bn43FqoL.js";import"./vue-DEEPytDe.js";import"./js-cookie-Cz0CWeBA.js";import"./nprogress-B-yuMcN-.js";import"./axios-Ds1py3KQ.js";import"./lodash-CnNYTNB6.js";import"./mitt-DJ65BbbF.js";import"./file-saver-B2L8jjWN.js";import"./diygw-datav-DLF-c6uN.js";import"./lodash-es-CW97kIZl.js";import"./@vueuse-BIgT8fdk.js";import"./@popperjs-CER6Qr1e.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-r8A8W4xn.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-DwF5HINA.js";import"./escape-html-HzfLCvW4.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DuJrlvqV.js";const xe={class:"system-user-container container"},ve={class:"head-container"},we={class:"head-container"},be={class:"mb8"},Ce=ee({__name:"index",setup(Pe){const{proxy:u}=de(),x=te(),e=ae({tableData:[],total:0,loading:!1,postOptions:[],defaultProps:{children:"children",label:"deptName"},sexOptions:[],roleOptions:[],statusOptions:[],deptName:void 0,single:!0,multiple:!0,ids:[],title:"",deptOptions:void 0,queryParams:{pageNum:1,pageSize:10,username:void 0,phone:void 0,status:void 0,deptId:void 0}});oe(()=>e.deptName,a=>{u.$refs.tree.filter(a)});const v=async()=>{e.loading=!0,D("/sys/user",e.queryParams).then(a=>{a.code!=200&&(e.loading=!1),e.tableData=a.rows,e.total=a.total,e.loading=!1})},B=a=>{e.ids=a.map(n=>n.userId),e.single=a.length!=1,e.multiple=!a.length},i=async()=>{e.queryParams.pageNum=1,await v()},S=async()=>{e.queryParams.pageNum=1,e.queryParams.pageSize=10,e.queryParams.username="",e.queryParams.phone="",e.queryParams.status="",e.queryParams.deptId=0,i()},O=()=>{e.title="添加用戶",x.value.openDialog(null)},T=a=>{e.title="修改用户",x.value.openDialog(a)},z=async()=>{D("/sys/dept",{}).then(a=>{e.deptOptions=_e(a.rows,"deptId","parentId","children")})},U=a=>{let n=a.status==="0"?"启用":"停用";w({title:"警告",message:'确认要"'+n+'""'+a.username+'"用户吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:(c,C,_)=>{if(c==="confirm")return fe("/sys/user",{userId:a.userId,status:a.status}).then(()=>{N.success(n+"成功"),_()});_()}}).catch(()=>{a.status=a.status==="0"?"1":"0"})},b=a=>{const n=a.userId||e.ids;w({message:'是否确认删除用户编号为"'+n+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return he("/sys/user",n).then(()=>{i(),N.success("删除成功")})})},E=a=>{e.queryParams.pageSize=a,i()},M=a=>{e.queryParams.pageNum=a,i()},F=(a,n)=>a?n.deptName.indexOf(a)!==-1:!0,$=a=>{e.queryParams.deptId=a.deptId,v(),e.queryParams.deptId=0},L=()=>{const a=e.queryParams;w({message:"是否确认导出所有用户数据项?",title:"警告",confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){let n=pe();u.download("/sys/user/export",a,`角色_${n}.xlsx`)})},K=a=>u.selectDictLabel(e.sexOptions,a.sex);return le(()=>{v(),z(),e.statusOptions=u.getDict("sys_normal_disable"),u.getDicts("sys_user_sex").then(a=>{e.sexOptions=a.rows}),u.mittBus.on("onEditUserModule",()=>{i()})}),ne(()=>{u.mittBus.off("onEditUserModule")}),(a,n)=>{const c=s("el-input"),C=s("el-tree"),_=s("el-col"),f=s("el-form-item"),R=s("el-option"),A=s("el-select"),d=s("SvgIcon"),p=s("el-button"),H=s("el-form"),r=s("el-table-column"),Q=s("el-image"),j=s("el-switch"),W=s("el-table"),X=s("el-divider"),Y=s("el-pagination"),G=s("el-row"),J=s("el-card"),Z=se("loading");return g(),P("div",xe,[t(J,{shadow:"always"},{default:l(()=>[t(G,{gutter:20},{default:l(()=>[t(_,{span:4,xs:24},{default:l(()=>[y("div",ve,[t(c,{modelValue:e.deptName,"onUpdate:modelValue":n[0]||(n[0]=o=>e.deptName=o),placeholder:"请输入部门名称",clearable:"","prefix-icon":q(me),style:{"margin-bottom":"20px"}},null,8,["modelValue","prefix-icon"])]),y("div",we,[t(C,{data:e.deptOptions,props:e.defaultProps,"node-key":"deptId","expand-on-click-node":!1,"filter-node-method":F,ref:"tree","default-expand-all":"",onNodeClick:$},null,8,["data","props"])])]),_:1}),t(_,{span:20,xs:24},{default:l(()=>[t(H,{model:e.queryParams,ref:"queryForm",inline:!0,"label-width":"78px"},{default:l(()=>[t(f,{label:"用户名称",prop:"username"},{default:l(()=>[t(c,{placeholder:"用户名称模糊查询",clearable:"",onKeyup:k(i,["enter"]),style:{width:"240px"},modelValue:e.queryParams.username,"onUpdate:modelValue":n[1]||(n[1]=o=>e.queryParams.username=o)},null,8,["modelValue"])]),_:1}),t(f,{label:"手机号码",prop:"phone"},{default:l(()=>[t(c,{modelValue:e.queryParams.phone,"onUpdate:modelValue":n[2]||(n[2]=o=>e.queryParams.phone=o),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:k(i,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"状态",prop:"status"},{default:l(()=>[t(A,{modelValue:e.queryParams.status,"onUpdate:modelValue":n[3]||(n[3]=o=>e.queryParams.status=o),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:l(()=>[(g(!0),P(re,null,ie(e.statusOptions,o=>(g(),V(R,{key:o.dictValue,label:o.dictLabel,value:o.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:l(()=>[t(p,{type:"primary",onClick:i},{default:l(()=>[t(d,{name:"ele-Search"}),m(" 搜索 ")]),_:1}),t(p,{onClick:S},{default:l(()=>[t(d,{name:"ele-Refresh"}),m(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"]),y("div",be,[t(p,{type:"primary",plain:"",onClick:O},{default:l(()=>[t(d,{name:"ele-Plus"}),m("新增 ")]),_:1}),t(p,{type:"danger",plain:"",disabled:e.multiple,onClick:b},{default:l(()=>[t(d,{name:"ele-Delete"}),m("删除 ")]),_:1},8,["disabled"]),t(p,{type:"warning",plain:"",onClick:L},{default:l(()=>[t(d,{name:"ele-Download"}),m("导出 ")]),_:1})]),I((g(),V(W,{border:"",data:e.tableData,stripe:"",onSelectionChange:B,style:{width:"100%"}},{default:l(()=>[t(r,{type:"selection",width:"45",align:"center"}),t(r,{label:"用户编号",align:"center",key:"userId",prop:"userId"}),t(r,{label:"用户名",prop:"username","show-overflow-tooltip":""}),t(r,{label:"头像","show-overflow-tooltip":""},{default:l(o=>[t(Q,{class:"system-user-photo",src:o.row.avatar?o.row.avatar:q(ge)(o.row.username)},null,8,["src"])]),_:1}),t(r,{label:"用户性别",align:"center",prop:"sex",formatter:K}),t(r,{prop:"phone",label:"手机","show-overflow-tooltip":""}),t(r,{prop:"email",label:"邮箱","show-overflow-tooltip":""}),t(r,{label:"状态",align:"center",key:"status"},{default:l(o=>[t(j,{modelValue:o.row.status,"onUpdate:modelValue":h=>o.row.status=h,"active-value":"0","inactive-value":"1",onClick:h=>U(o.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),t(r,{prop:"createTime",label:"创建时间","show-overflow-tooltip":""}),t(r,{prop:"path",label:"操作",fixed:"right",width:"180"},{default:l(o=>[t(p,{type:"text",onClick:h=>T(o.row)},{default:l(()=>[t(d,{name:"ele-Edit"}),m("修改 ")]),_:2},1032,["onClick"]),t(p,{type:"text",onClick:h=>b(o.row)},{default:l(()=>[t(d,{name:"ele-Delete"}),m("删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,e.loading]]),I(y("div",null,[t(X),t(Y,{background:"",total:e.total,"page-sizes":[10,20,30],"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:M},null,8,["total","current-page","page-size"])],512),[[ue,e.total>0]])]),_:1})]),_:1})]),_:1}),t(ce,{ref_key:"userFormRef",ref:x,title:e.title},null,8,["title"])])}}}),Ze=ye(Ce,[["__scopeId","data-v-510cadfe"]]);export{Ze as default};
