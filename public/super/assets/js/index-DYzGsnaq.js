import{h as z,f as ae,j as K,i as oe,ag as E,o as s,c as d,a as h,F as C,p as S,v as O,t as ne,S as x,T as U,X as _,a8 as W,q as se,x as I,d as ee,u as D,a3 as P,Q as X,L as G,W as ue}from"./@vue-CRBWlwId.js";import{m as re,p as de}from"./@vueuse-BIgT8fdk.js";import{t as H}from"./vue-draggable-plus-D90yCKwz.js";import{n as ie}from"./index-BfYElSN2.js";import{D as Y}from"./uploadinput-CMX3D0tT.js";import{E as ce,a as Z}from"./element-plus-C9Ov05af.js";const pe={key:0,class:"sku-table"},me={class:"diy-table diy-skutable"},fe={key:1,class:"spec-title"},he={key:0},ve=["rowspan"],ye={key:0},ge=ee({name:"DiySkutable",inheritAttrs:!0}),Ve=Object.assign(ge,{props:{modelValue:{type:Array,default:()=>[]},specs:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},filterable:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(v,{emit:q}){const y=v,N=re(y,"modelValue",q),i=z({}),k=z({}),B=z([]),T=z([]);ae(()=>{j()});function j(){B.value=L(),T.value=B.value,p()}function M(a){a.forEach((o,u)=>{o.columns.forEach((l,e)=>{l.shouldSetRowSpan=c(u,e)})})}function L(){let a=[],o=y.modelValue,u={};y.specs.forEach(l=>{u[l.title]=""}),i.value=u;for(let l=0;l<F.value;l++){let e=y.specs.map((m,n)=>{let{title:b,id:w}=V(l,n);return{shouldSetRowSpan:c(l,n),showValue:b,valueId:w,columnName:m.title,columnId:m.id,precision:m.precision}}),J=e.map(m=>m.valueId).sort().toString(),t=o.find(m=>m.specIds===J);o.length>0&&o.length>=l&&!t&&o[0].specIds.split(",").length!=e.length&&(t=o[l]),a.push({id:ie(),...r(e,l,t),columns:e})}return a}function r(a,o,u){return y.columns.reduce((l,e)=>(e.defaultValue?typeof e.defaultValue=="string"?l[e.id]=e.defaultValue:typeof e.defaultValue=="function"&&(l[e.id]=e.defaultValue({columns:a,rowIndex:o})):u&&u[e.id]?l[e.id]=u[e.id]||"":e.defaultValue?typeof e.defaultValue=="string"?l[e.id]=e.defaultValue:typeof e.defaultValue=="function"&&(l[e.id]=e.defaultValue({columns:a,rowIndex:o})):k.value[e.id]?l[e.id]=k.value[e.id]:l.type=="number"?l[e.id]=0:l[e.id]="",l),{})}function c(a,o){return a%R.value[o]===0}function V(a,o){let u=y.specs[o].datas,l;if(o===y.specs.length-1)l=a%u.length;else{let e=R.value[o];l=Math.floor(a/e),l>=u.length&&(l=l%u.length)}return u[l]}function g(a){ce.confirm("确认批量修改吗?","提示",{customClass:"diygw-messagebox",confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{let o=k.value[a];T.value.forEach(u=>{u[a]=o}),p()}).catch(()=>{})}function A(a,o,u){p()}function p(){let a=B.value.map(o=>{let u=y.columns.reduce((l,e)=>(l[e.id]=e.format?e.format(o[e.id]):o[e.id],l),{});return{specIds:o.columns.map(l=>l.valueId).join(","),...u}});N.value=a}const $=K(()=>Object.values(i.value).filter(a=>!!a).length>0),f=K(()=>y.specs.map(a=>a.datas.length).map((a,o)=>$.value&&i.value[y.specs[o].title]?1:a)),F=K(()=>f.value.reduce((a,o)=>a*o,f.value.length?1:0)),R=K(()=>f.value.reduce((a,o,u)=>{let l=a[u-1];return l?a.push(l/o):a.push(F.value/o),a},[])),le=K(()=>{let a=Array.from(new Array(F.value).keys());return R.value.map((o,u,l)=>u===l.length-1?null:a.filter(e=>e%o===0).pop())});oe(()=>y.specs,()=>{j()},{deep:!0,immediate:!0});function te(){if($.value){let a=B.value.filter(o=>o.columns.reduce((u,l)=>{let e=i.value[l.columnName];return e?u&&l.showValue===e:u},!0));M(a),T.value=a}else M(B.value),T.value=B.value}return(a,o)=>{const u=E("el-option"),l=E("el-select"),e=E("el-input-number"),J=E("el-input");return v.specs.length>0?(s(),d("div",pe,[h("table",me,[h("tr",null,[(s(!0),d(C,null,S(v.specs,(t,m)=>(s(),d("th",{key:m},O(t.title),1))),128)),(s(!0),d(C,null,S(v.columns,(t,m)=>(s(),d("th",{style:ne({width:t.type=="number"?"100px":"auto"}),key:m+v.specs.length+1},O(t.title),5))),128))]),h("tr",null,[(s(!0),d(C,null,S(v.specs,(t,m)=>(s(),d("td",{key:m},[v.filterable?(s(),x(l,{key:0,onChange:te,modelValue:i.value[t.title],"onUpdate:modelValue":n=>i.value[t.title]=n,placeholder:"过滤查询",clearable:""},{default:U(()=>[_(u,{label:"全部",value:""}),(s(!0),d(C,null,S(t.datas,(n,b)=>(s(),x(u,{key:b,label:n.title,value:n.title},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(s(),d("span",fe,O(t.title),1))]))),128)),(s(!0),d(C,null,S(v.columns,(t,m)=>(s(),d("td",{key:m+v.specs.length+1},[t.readOnly?(s(),d("span",he,O(t.title),1)):t.type=="img"?(s(),x(Y,{key:1,class:"diygw-col-24",onBlur:()=>{g(t.id)},placeholder:"批量修改",modelValue:k.value[t.id],"onUpdate:modelValue":n=>k.value[t.id]=n},null,8,["onBlur","modelValue","onUpdate:modelValue"])):t.type=="number"?(s(),x(e,{key:2,min:0,precision:t.precision?t.precision:0,step:t.precision?.1:1,modelValue:k.value[t.id],"onUpdate:modelValue":n=>k.value[t.id]=n,"controls-position":"right",controls:!1,class:"sku-input-number",onBlur:()=>{g(t.id)},onKeyup:W(()=>{g(t.id)},["native","enter"]),placeholder:"批量修改"},null,8,["precision","step","modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(s(),x(J,{key:3,class:"diygw-col-24",modelValue:k.value[t.id],"onUpdate:modelValue":n=>k.value[t.id]=n,onBlur:()=>{g(t.id)},onKeyup:W(()=>{g(t.id)},["native","enter"]),placeholder:"批量修改"},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"]))]))),128))]),(s(!0),d(C,null,S(T.value,(t,m)=>(s(),d("tr",{key:t.id},[(s(!0),d(C,null,S(t.columns,(n,b)=>(s(),d("td",{class:se([n.shouldSetRowSpan?"":"hide",m===le.value[b]?"col-last-rowspan":"",b<v.specs.length-1?"row-span-style":""]),rowspan:n.shouldSetRowSpan?R.value[b]:"",key:b},[h("span",null,O(n.showValue),1)],10,ve))),128)),(s(!0),d(C,null,S(v.columns,(n,b)=>(s(),d("td",{key:b+v.columns.length+1},[n.readOnly?(s(),d("span",ye,O(t[n.id]),1)):n.type=="img"?(s(),x(Y,{key:1,onChange:w=>{A()},placeholder:n.title,modelValue:t[n.id],"onUpdate:modelValue":w=>t[n.id]=w},null,8,["onChange","placeholder","modelValue","onUpdate:modelValue"])):n.type=="number"?(s(),x(e,{key:2,min:0,precision:n.precision?n.precision:0,step:n.precision?.1:1,modelValue:t[n.id],"onUpdate:modelValue":w=>t[n.id]=w,"controls-position":"right",controls:!1,class:"sku-input-number",onChange:w=>{A()},placeholder:n.title},null,8,["precision","step","modelValue","onUpdate:modelValue","onChange","placeholder"])):(s(),x(J,{key:3,modelValue:t[n.id],"onUpdate:modelValue":w=>t[n.id]=w,onChange:w=>{A()},placeholder:n.title},null,8,["modelValue","onUpdate:modelValue","onChange","placeholder"]))]))),128))]))),128))])])):I("",!0)}}}),_e={class:"diygw-col-24"},ke={key:0},be={class:"box sku-spec flex flex-direction-column margin-bottom"},we={class:"flex margin-bottom-xs align-center justify-between"},Ce={class:"toolbar"},Se=h("i",{class:"diyicon handle diyicon-yidongxuanze"},null,-1),Ue=["onClick"],Be=["onClick"],$e=["onClick"],xe={class:"flex flex-wrap align-center"},Te={class:"margin-right-xs spec-item margin-bottom-xs",style:{width:"150px"}},Ae={class:"spec-toolbar"},Re=["onClick"],De=["onClick"],Ee=ee({name:"DiySku",inheritAttrs:!0}),Pe=Object.assign(Ee,{props:{skus:{type:Array,default:()=>[]},specs:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},filterable:{type:Boolean,default:!0}},emits:["update:specs","update:skus"],setup(v,{emit:q}){const y=v,Q=q,{skus:N,specs:i}=de(y,Q),k=r=>{i.value.splice(r,1)},B=(r,c)=>{i.value[r].datas.splice(c,1)},T=r=>{let c=i.value[r].datas.length+i.value[r].id;i.value[r].datas.push({title:"",id:c+""+new Date().getTime()})},j=()=>{let r=(i.value.length+1)*1e3;i.value.push({id:r,title:"",datas:[{title:"",id:r+""+new Date().getTime()}]})},M=z(JSON.parse(JSON.stringify(y.columns)));M.value.push({title:"关键词",id:"keywords",readOnly:!0,defaultValue:({columns:r})=>r.map(c=>c.showValue).join(" ")});const L=(r,c)=>{let V=i.value,g=V[r];if(c=="up"){if(r==0){Z.error("已经是第一个了！");return}const p=V[r-1];V[r-1]=g,V[r]=p}else if(r==V.length-1){Z.error("已经是最一个了！");return}else{const p=V[r+1];V[r+1]=g,V[r]=p}};return(r,c)=>{const V=E("el-input"),g=E("el-tooltip"),A=E("el-button");return s(),d("div",_e,[D(i).length>0?(s(),d("div",ke,[_(D(H),X({animation:200,disabled:!1,ghostClass:"ghost"},{modelValue:D(i),"onUpdate:modelValue":c[1]||(c[1]=p=>G(i)?i.value=p:null),class:"list-group","ghost-class":"ghost"}),{default:U(()=>[(s(!0),d(C,null,S(D(i),(p,$)=>(s(),d("div",be,[h("div",we,[_(V,{style:{width:"200px !important",flex:"unset"},placeholder:"请输入规格名称",modelValue:p.title,"onUpdate:modelValue":f=>p.title=f},null,8,["modelValue","onUpdate:modelValue"]),h("div",Ce,[Se,_(g,{content:"上移",placement:"bottom"},{default:U(()=>[h("i",{class:"diy-icon-top",onClick:P(f=>L($,"up"),["stop"])},null,8,Ue)]),_:2},1024),_(g,{content:"下移",placement:"bottom"},{default:U(()=>[h("i",{class:"diy-icon-down",onClick:P(f=>L($,"down"),["stop"])},null,8,Be)]),_:2},1024),_(g,{content:"新增规格组",placement:"bottom"},{default:U(()=>[h("i",{class:"diy-icon-add",onClick:c[0]||(c[0]=P(f=>j(),["stop"]))})]),_:1}),_(g,{content:"删除规格组",placement:"bottom"},{default:U(()=>[h("i",{class:"diy-icon-close",onClick:P(f=>k($),["stop"])},null,8,$e)]),_:2},1024)])]),h("div",xe,[_(D(H),X({animation:200,disabled:!1,ghostClass:"ghost"},{modelValue:p.datas,"onUpdate:modelValue":f=>p.datas=f,class:"flex flex-wrap align-center sku-spec-item","ghost-class":"ghost"}),{default:U(()=>[(s(!0),d(C,null,S(p.datas,(f,F)=>(s(),d("div",Te,[_(V,{modelValue:f.title,"onUpdate:modelValue":R=>f.title=R},null,8,["modelValue","onUpdate:modelValue"]),h("div",Ae,[_(g,{content:"删除规格值",placement:"bottom"},{default:U(()=>[h("i",{class:"diy-icon-close",onClick:P(R=>B($,F),["stop"])},null,8,Re)]),_:2},1024)])]))),256))]),_:2},1040,["modelValue","onUpdate:modelValue"]),h("div",{class:"margin-right-xs margin-bottom-xs text-xs",onClick:f=>T($)},"新增规格值",8,De)])]))),256))]),_:1},16,["modelValue"])])):I("",!0),_(A,{class:"diygw-col-24 margin-bottom-xs",onClick:j},{default:U(()=>[ue("新增规格")]),_:1}),_(Ve,{modelValue:D(N),"onUpdate:modelValue":c[2]||(c[2]=p=>G(N)?N.value=p:null),specs:D(i),columns:M.value,ref:"skuref"},null,8,["modelValue","specs","columns"])])}}});export{Pe as _};
