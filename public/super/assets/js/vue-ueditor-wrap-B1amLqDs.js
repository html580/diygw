import{d as T,h as V,_ as j,i as N,n as P,a7 as S,y as Y,X as D}from"./@vue-CRBWlwId.js";function $(t){return t.replace(/-(\w)/g,function(e,r){return r?r.toUpperCase():""})}function F(t){return t.install=function(e){var r=t,n=r.name;e.component(n,t),e.component($("-"+n),t)},t}var M=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(n,d){this.listeners[n]===void 0&&(this.listeners[n]={triggered:!1,requested:!1,cbs:[]}),this.listeners[n].triggered&&d(),this.listeners[n].cbs.push(d)},e.emit=function(n){this.listeners[n]&&(this.listeners[n].triggered=!0,this.listeners[n].cbs.forEach(function(d){return d()}))},t}();function q(t,e){var r,n=function(){for(var l=this,i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];r&&clearTimeout(r),r=setTimeout(function(){t.apply(l,s)},e)};return n.cancel=function(){r!==void 0&&clearTimeout(r)},n}function H(t){return t.reduce(function(e,r){return e.then(r)},Promise.resolve())}function x(t){for(var e="abcdefghijklmnopqrstuvwxyz",r="",n=0;n<t;n++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}const G=T({name:"vue-ueditor-wrap",props:{editorId:String,name:String,modelValue:{type:String,default:""},config:Object,mode:{type:String,default:"observer",validator:function(e){return["observer","listener"].indexOf(e)!==-1}},observerOptions:{type:Object,default:function(){return{attributes:!0,attributeFilter:["src","style","type","name"],characterData:!0,childList:!0,subtree:!0}}},observerDebounceTime:{type:Number,default:50,validator:function(e){return e>=20}},forceInit:Boolean,destroy:{type:Boolean,default:!0},editorDependencies:{type:Array},editorDependenciesChecker:{type:Function}},emits:["update:modelValue","before-init","ready"],setup:function(e,r){var n=r.emit,d={UN_READY:"UN_READY",PENDING:"PENDING",READY:"READY"},l=d.UN_READY,i,s,c,E=V(),y=["ueditor.config.js","ueditor.all.min.js"],C=function(){return window.UE&&window.UE.getEditor&&window.UEDITOR_CONFIG&&Object.keys(window.UEDITOR_CONFIG).length!==0},L=j(e,"modelValue");window.$loadEventBus||(window.$loadEventBus=new M);var U=function(o){return new Promise(function(h,m){if(window.$loadEventBus.on(o,h),window.$loadEventBus.listeners[o].requested===!1){window.$loadEventBus.listeners[o].requested=!0;var a=document.createElement("script");a.src=o,a.onload=function(){window.$loadEventBus.emit(o)},a.onerror=m,document.getElementsByTagName("head")[0].appendChild(a)}})},p=function(o){return new Promise(function(h,m){if(window.$loadEventBus.on(o,h),window.$loadEventBus.listeners[o].requested===!1){window.$loadEventBus.listeners[o].requested=!0;var a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=o,a.onload=function(){window.$loadEventBus.emit(o)},a.onerror=m,document.getElementsByTagName("head")[0].appendChild(a)}})},A=function(){return new Promise(function(o,h){if(e.editorDependencies&&e.editorDependenciesChecker&&e.editorDependenciesChecker()){o();return}if(!e.editorDependencies&&C()){o();return}var m=(e.editorDependencies||y).reduce(function(f,v){var _=/^((https?:)?\/\/)?[-a-zA-Z0-9]+(\.[-a-zA-Z0-9]+)+\//.test(v);if(!_){var b;v=(((b=e.config)==null?void 0:b.UEDITOR_HOME_URL)||"")+v}return v.slice(-3)===".js"?f.jsLinks.push(v):v.slice(-4)===".css"&&f.cssLinks.push(v),f},{jsLinks:[],cssLinks:[]}),a=m.jsLinks,R=m.cssLinks;Promise.all([Promise.all(R.map(function(f){return p(f)})),H(a.map(function(f){return function(){return U(f)}}))]).then(function(){return o()}).catch(h)})},w=function(){c=i.getContent(),n("update:modelValue",c)},B=function(){i.addListener("contentChange",w)},I=function(){i.document.getElementById("baidu_pastebin")||(c=i.getContent(),n("update:modelValue",c))},O=function(){s=new MutationObserver(q(I,e.observerDebounceTime)),s.observe(i.body,e.observerOptions)},g=function(){var o=e.editorId||"editor_"+x(8);E.value.id=o,n("before-init",o),i=window.UE.getEditor(o,e.config),i.addListener("ready",function(){l===d.READY?i.setContent(e.modelValue):(l=d.READY,n("ready",i),e.modelValue&&i.setContent(e.modelValue)),e.mode==="observer"&&window.MutationObserver?O():B()})};return N(L,function(u){l===d.UN_READY?(l=d.PENDING,(e.forceInit||typeof window<"u")&&A().then(function(){E.value?g():P(function(){return g()})}).catch(function(){throw new Error("[vue-ueditor-wrap] UEditor 资源加载失败！请检查资源是否存在，UEDITOR_HOME_URL 是否配置正确！")})):l===d.READY&&(u===c||i.setContent(u||""))},{immediate:!0}),S(function(){i&&i.removeListener("contentChange",w),s&&s.disconnect()}),Y(function(){s&&s.disconnect&&s.disconnect(),e.destroy&&i&&i.destroy&&i.destroy()}),function(){return D("div",null,[D("div",{ref:E,name:e.name},null)])}}});var W=F(G);export{W as V};
