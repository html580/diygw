import{d as we,h as D,m as Fe,f as Se,ag as d,aq as j,o as m,c as N,X as t,T as a,a8 as X,F as P,p as O,S as y,W as u,a as V,U as _,Y,v as Ke,e as Ne,u as i,n as I}from"./@vue-CRBWlwId.js";import{l as U,h as G,z as Ie,x as J,k as qe,m as Z,i as De}from"./index-BfYElSN2.js";import{g as Pe}from"./formatTime-Bwg9I4Gs.js";import{a as F,E}from"./element-plus-C9Ov05af.js";import"./pinia-BTdriGDs.js";import"./vue-router-B8aOcPyE.js";import"./vue-i18n-Bpsr_IBC.js";import"./@intlify-Bn43FqoL.js";import"./vue-DEEPytDe.js";import"./js-cookie-Cz0CWeBA.js";import"./@element-plus-tztFf6PP.js";import"./nprogress-B-yuMcN-.js";import"./axios-Ds1py3KQ.js";import"./lodash-CnNYTNB6.js";import"./mitt-DJ65BbbF.js";import"./file-saver-B2L8jjWN.js";import"./diygw-datav-DLF-c6uN.js";import"./lodash-es-CW97kIZl.js";import"./@vueuse-BIgT8fdk.js";import"./@popperjs-CER6Qr1e.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-r8A8W4xn.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-DwF5HINA.js";import"./escape-html-HzfLCvW4.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DuJrlvqV.js";const Oe={class:"container"},Ue={class:"mb8"},Ee={class:"dialog-footer"},Te={class:"dialog-footer"},il=we({__name:"index",setup(Le){const{proxy:T}=Ne(),L=D(null),b=D(null),k=D(null),e=Fe({activeName:"first",loading:!0,bunLoading:!1,ids:[],total:0,title:"",open:!1,roleList:[],showSearch:!0,single:!0,multiple:!0,statusOptions:[],menuOptions:[],menuCheckedKeys:[],deptOptions:[],openDataScope:!1,menuExpand:!1,menuNodeAll:!1,deptExpand:!0,deptNodeAll:!1,queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],roleForm:{},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),S=()=>{e.menuExpand=!1,e.menuNodeAll=!1,e.deptExpand=!0,e.deptNodeAll=!1,e.roleForm={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},e.roleForm={}},ee=()=>{e.queryParams.pageNum=1,e.queryParams.pageSize=10,e.queryParams.roleName="",e.queryParams.roleKey="",e.queryParams.status="",x()},C=()=>{e.loading=!0,U("/sys/role",e.queryParams).then(r=>{e.roleList=r.rows,e.total=r.total,e.loading=!1})},le=r=>{e.queryParams.pageSize=r,x()},te=r=>{e.queryParams.pageNum=r,x()},oe=()=>{e.roleForm.roleId!=null&&(e.roleForm.deptIds=ae(),G("/sys/role",e.roleForm).then(()=>{F.success("修改成功"),e.openDataScope=!1,C()}))},ae=()=>{const r=i(k);let l=r.getCheckedKeys(),s=r.getHalfCheckedKeys();return l.unshift.apply(l,s),l},x=()=>{e.queryParams.pageNum=1,C()},re=r=>{e.ids=r.map(l=>l.roleId),e.single=r.length!=1,e.multiple=!r.length},ne=r=>{let l=r.status==="0"?"启用":"停用";E({closeOnClickModal:!1,closeOnPressEscape:!1,title:"警告",message:'确认要"'+l+'""'+r.roleName+'"角色吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return Ie("/sys/role",{roleId:r.roleId,status:r.status})}).then(()=>{F.success(l+"成功")}).catch(function(){r.status=r.status==="0"?"1":"0"})},se=r=>{S(),pe(),J("/sys/role",r.roleId).then(l=>{e.roleForm=l.data,e.openDataScope=!0,I(()=>{let s=l.data.deptIds;const n=i(k);s.forEach(c=>{n.setChecked(c,!0,!1)})}),e.title="分配数据权限"})},de=async()=>{S(),e.menuOptions.length==0&&await W(),e.open=!0,I(()=>{const r=i(b);e.menuCheckedKeys=[],r.setCheckedKeys([],!1)}),e.title="添加角色"},ue=async r=>{const l=r.roleId;e.menuOptions.length==0&&await W(),J("/sys/role",l).then(s=>{e.menuCheckedKeys=s.data.menuIds,e.roleForm=s.data,e.open=!0,e.title="修改角色",I(()=>{const n=i(b);n.setCheckedKeys([],!1),e.menuCheckedKeys.forEach(c=>{I(()=>{n.setChecked(c,!0,!1)})})})}),e.bunLoading=!1},B=r=>{const l=r.roleId||e.ids;E({message:'是否确认删除角色编号为"'+l+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return qe("/sys/role",l)}).then(()=>{C(),F.success("删除成功")})},me=()=>{const r=e.queryParams;E({message:"是否确认导出所有角色数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){let l=Pe();T.download("/sys/role/export",r,`角色_${l}.xlsx`)})},pe=()=>U("/sys/dept",{}).then(r=>(e.deptOptions=Z(r.rows,"deptId","parentId","children"),r.data)),W=()=>U("/sys/menu",{}).then(r=>(e.menuOptions=Z(r.rows,"menuId","parentId","children"),r.data)),ie=()=>{const r=i(L);r&&r.validate(l=>{l&&(e.bunLoading=!0,e.roleForm!=null&&e.roleForm.roleId!=null?(e.roleForm.menuIds=A(),G("/sys/role",e.roleForm).then(()=>{F.success("修改成功"),e.bunLoading=!0,e.open=!1,C()})):(e.roleForm.menuIds=A(),De("/sys/role",e.roleForm).then(()=>{F.success("新增成功"),e.bunLoading=!0,e.open=!1,C()})))})},ce=()=>{e.open=!1,S()},A=()=>{const r=i(b);if(!r)return;let l=r.getCheckedKeys(),s=r.getHalfCheckedKeys();return l.unshift.apply(l,s),l},fe=()=>{e.openDataScope=!1,S()},ye=r=>{const l=i(k);r!=="2"?l.setCheckedKeys([]):e.roleForm.deptIds.length>0?e.roleForm.deptIds.forEach(n=>{l.setChecked(n,!0,!1)}):l.setCheckedKeys([])},z=(r,l)=>{if(l=="menu"){let s=e.menuOptions;for(let n=0;n<s.length;n++){const c=i(b);c.store.nodesMap[s[n].menuId].expanded=r}}else if(l=="dept"){let s=e.deptOptions;for(let n=0;n<s.length;n++){const c=i(k);c.store.nodesMap[s[n].deptId].expanded=r}}},R=(r,l)=>{l=="menu"?i(b).setCheckedNodes(r?e.menuOptions:[]):l=="dept"&&i(k).setCheckedNodes(r?e.deptOptions:[])};return Se(()=>{C(),T.getDicts("sys_normal_disable").then(r=>{e.statusOptions=r.rows})}),(r,l)=>{const s=d("el-input"),n=d("el-form-item"),c=d("el-option"),M=d("el-select"),g=d("SvgIcon"),p=d("el-button"),q=d("el-form"),h=d("el-table-column"),ge=d("el-switch"),he=d("el-table"),_e=d("el-divider"),be=d("el-pagination"),ke=d("el-card"),f=d("el-col"),Ce=d("el-input-number"),xe=d("el-radio"),Ve=d("el-radio-group"),K=d("el-checkbox"),$=d("el-tree"),H=d("el-row"),Q=d("el-dialog"),v=j("auth"),ve=j("loading");return m(),N("div",Oe,[t(ke,{shadow:"always"},{default:a(()=>[t(q,{model:e.queryParams,ref:"queryForm",inline:!0},{default:a(()=>[t(n,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(s,{placeholder:"角色名称模糊查询",clearable:"",onKeyup:X(x,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleName,"onUpdate:modelValue":l[0]||(l[0]=o=>e.queryParams.roleName=o)},null,8,["modelValue"])]),_:1}),t(n,{label:"权限字符",prop:"roleKey"},{default:a(()=>[t(s,{placeholder:"权限字符模糊查询",clearable:"",onKeyup:X(x,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleKey,"onUpdate:modelValue":l[1]||(l[1]=o=>e.queryParams.roleKey=o)},null,8,["modelValue"])]),_:1}),t(n,{label:"状态",prop:"status"},{default:a(()=>[t(M,{modelValue:e.queryParams.status,"onUpdate:modelValue":l[2]||(l[2]=o=>e.queryParams.status=o),placeholder:"角色状态",clearable:"",style:{width:"240px"}},{default:a(()=>[(m(!0),N(P,null,O(e.statusOptions,o=>(m(),y(c,{key:o.dictValue,label:o.dictLabel,value:o.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,null,{default:a(()=>[t(p,{type:"primary",onClick:x},{default:a(()=>[t(g,{name:"ele-Search"}),u(" 搜索 ")]),_:1}),t(p,{onClick:ee},{default:a(()=>[t(g,{name:"ele-Refresh"}),u(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"]),V("div",Ue,[_((m(),y(p,{type:"primary",plain:"",onClick:de},{default:a(()=>[t(g,{name:"ele-Plus"}),u("新增 ")]),_:1})),[[v,"system:role:add"]]),_((m(),y(p,{type:"danger",plain:"",disabled:e.multiple,onClick:B},{default:a(()=>[t(g,{name:"ele-Delete"}),u("删除 ")]),_:1},8,["disabled"])),[[v,"system:role:delete"]]),_((m(),y(p,{type:"warning",plain:"",onClick:me},{default:a(()=>[t(g,{name:"ele-Download"}),u("导出 ")]),_:1})),[[v,"system:role:export"]])]),_((m(),y(he,{border:"",data:e.roleList,onSelectionChange:re},{default:a(()=>[t(h,{type:"selection",width:"55",align:"center"}),t(h,{label:"角色编号",prop:"roleId",width:"120"}),t(h,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0}),t(h,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),t(h,{label:"显示顺序",prop:"roleSort",width:"100"}),t(h,{label:"状态",align:"center",width:"100"},{default:a(o=>[t(ge,{modelValue:o.row.status,"onUpdate:modelValue":w=>o.row.status=w,"active-value":"0","inactive-value":"1",onClick:w=>ne(o.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),t(h,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),t(h,{label:"操作",align:"center",fixed:"right",width:"280"},{default:a(o=>[_((m(),y(p,{type:"text",onClick:w=>ue(o.row)},{default:a(()=>[t(g,{name:"ele-Edit"}),u("修改 ")]),_:2},1032,["onClick"])),[[v,"system:role:edit"]]),t(p,{type:"text",onClick:w=>se(o.row)},{default:a(()=>[t(g,{name:"ele-CircleCheck"}),u("数据权限 ")]),_:2},1032,["onClick"]),_((m(),y(p,{type:"text",onClick:w=>B(o.row)},{default:a(()=>[t(g,{name:"ele-Delete"}),u("删除 ")]),_:2},1032,["onClick"])),[[v,"system:role:delete"]])]),_:1})]),_:1},8,["data"])),[[ve,e.loading]]),_(V("div",null,[t(_e),t(be,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:le,onCurrentChange:te},null,8,["total","current-page","page-size"])],512),[[Y,e.total>0]])]),_:1}),t(Q,{title:e.title,modelValue:e.open,"onUpdate:modelValue":l[12]||(l[12]=o=>e.open=o),width:"769px",center:""},{footer:a(()=>[V("span",Ee,[t(p,{type:"primary",loading:e.bunLoading,onClick:ie},{default:a(()=>[u("确 定")]),_:1},8,["loading"]),t(p,{onClick:ce},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[t(q,{ref_key:"roleFormRef",ref:L,model:e.roleForm,rules:e.rules,"label-width":"120px","label-position":"right"},{default:a(()=>[t(H,null,{default:a(()=>[t(f,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[t(n,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(s,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":l[3]||(l[3]=o=>e.roleForm.roleName=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[t(n,{label:"权限字符",prop:"roleKey"},{default:a(()=>[t(s,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":l[4]||(l[4]=o=>e.roleForm.roleKey=o),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[t(n,{label:"角色顺序",prop:"roleSort"},{default:a(()=>[t(Ce,{modelValue:e.roleForm.roleSort,"onUpdate:modelValue":l[5]||(l[5]=o=>e.roleForm.roleSort=o),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[t(n,{label:"状态"},{default:a(()=>[t(Ve,{modelValue:e.roleForm.status,"onUpdate:modelValue":l[6]||(l[6]=o=>e.roleForm.status=o)},{default:a(()=>[(m(!0),N(P,null,O(e.statusOptions,o=>(m(),y(xe,{key:o.dictValue,label:o.dictValue},{default:a(()=>[u(Ke(o.dictLabel),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24},{default:a(()=>[t(n,{label:"权限设置"},{default:a(()=>[V("div",null,[t(K,{modelValue:e.menuExpand,"onUpdate:modelValue":l[7]||(l[7]=o=>e.menuExpand=o),onChange:l[8]||(l[8]=o=>z(o,"menu"))},{default:a(()=>[u("展开/折叠 ")]),_:1},8,["modelValue"]),t(K,{modelValue:e.menuNodeAll,"onUpdate:modelValue":l[9]||(l[9]=o=>e.menuNodeAll=o),onChange:l[10]||(l[10]=o=>R(o,"menu"))},{default:a(()=>[u("全选/全不选 ")]),_:1},8,["modelValue"]),t($,{class:"tree-border",data:e.menuOptions,"show-checkbox":"",ref_key:"menuRef",ref:b,"node-key":"menuId","empty-text":"加载中，请稍后",props:{label:"menuName",children:"children"},"default-checked-keys":e.menuCheckedKeys},null,8,["data","default-checked-keys"])])]),_:1})]),_:1}),t(f,{xs:24},{default:a(()=>[t(n,{label:"备注"},{default:a(()=>[t(s,{modelValue:e.roleForm.remark,"onUpdate:modelValue":l[11]||(l[11]=o=>e.roleForm.remark=o),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(Q,{title:e.title,modelValue:e.openDataScope,"onUpdate:modelValue":l[20]||(l[20]=o=>e.openDataScope=o),width:"769px",center:""},{footer:a(()=>[V("span",Te,[t(p,{type:"primary",onClick:oe},{default:a(()=>[u("确 定")]),_:1}),t(p,{onClick:fe},{default:a(()=>[u("取 消")]),_:1})])]),default:a(()=>[t(q,{model:e.roleForm,"label-width":"80px"},{default:a(()=>[t(H,null,{default:a(()=>[t(f,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[t(n,{label:"角色名称"},{default:a(()=>[t(s,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":l[13]||(l[13]=o=>e.roleForm.roleName=o),disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[t(n,{label:"权限字符"},{default:a(()=>[t(s,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":l[14]||(l[14]=o=>e.roleForm.roleKey=o),disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24},{default:a(()=>[t(n,{label:"权限范围"},{default:a(()=>[t(M,{modelValue:e.roleForm.dataScope,"onUpdate:modelValue":l[15]||(l[15]=o=>e.roleForm.dataScope=o),onChange:ye},{default:a(()=>[(m(!0),N(P,null,O(e.dataScopeOptions,o=>(m(),y(c,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{xs:24},{default:a(()=>[_(t(n,{label:"数据权限"},{default:a(()=>[V("div",null,[t(K,{modelValue:e.deptExpand,"onUpdate:modelValue":l[16]||(l[16]=o=>e.deptExpand=o),onChange:l[17]||(l[17]=o=>z(o,"dept"))},{default:a(()=>[u("展开/折叠 ")]),_:1},8,["modelValue"]),t(K,{modelValue:e.deptNodeAll,"onUpdate:modelValue":l[18]||(l[18]=o=>e.deptNodeAll=o),onChange:l[19]||(l[19]=o=>R(o,"dept"))},{default:a(()=>[u("全选/全不选 ")]),_:1},8,["modelValue"]),t($,{class:"tree-border",data:e.deptOptions,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:k,"node-key":"deptId","empty-text":"加载中，请稍后",props:{label:"deptName",children:"children"}},null,8,["data"])])]),_:1},512),[[Y,e.roleForm.dataScope==2]])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{il as default};
